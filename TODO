

Done
====

TODO
====

- Printing system
	- Write tests:
		- Populate queue
		- AJAX handlers:
			- Fetch from queue
				- Lock database before and after
				- Should tell how many are remaining
			- Update queue
				- Take queue ID
	- Add button to editing form to print a badge
		- Maybe make "print badge" as a separate menu item?
			- Honor watchlist status
			- Tell in advance if the badge will be an adult or minor badge
		- Check current age for adult/minor status

- Move "membership levels" into Settings menu item

- Onsite reg
	- Separate set of permissions for registration staff
		- NO acccess to stats, settings or utilities
	- Create onsite reg form that doesn't have payment info
		- Create new class that calls reg_form->form() for form, but its own
			validation and submission functions?
			- Maybe split out reg_form->form into a separate class?
		- Thankyou text should be stored as a message
	- Create a form for staff members to "process/validate" registrations
		- Should only have a few fields.
		- Should have an option to print
	- WAMP issues
		- Folder to store Apache and MySQL configuration, SSL-generating scripts, etc.

- reg/
	autocomplete="off" in the input tag for the credit card number

- I guess reg_admin_log_view isn't needed since we deprecated those other
	log viewing functions.
	- Let's go back and move that code back into reg_admin_log, and update
		child classes and the factory accordingly.

- If watchlist is empty, display a single row in the watchlist indicating that.

- Timezones when editing levels.  Do we want to do anything there?  
	- Maybe allow an hour field?

- admin/reg/settings/mesages/1234/edit
	- Prevent editing of non-existant message IDs
	- Throw an error and log it

- modify code to get the name and last 4 of the card number to get that name
	from the first digit

- Multi-year code
	- Have a config value for the year, defaulting to the current year
		- Modify badge number assignment code to first check the 
			reg_badge_num table
			- Write a unit test for this!
	- At signup, display a year field for the admin
		- Default to the current year
	- Add year to member search page
	- For /reg, get year from from the level offering
	- Modify badge number assignment code to take a year argument

- Messages
	- When editing, instead of "ID 'id'", say "name 'name'"
	- When a message is saved, redirect to the list of messages

- reg-wide email on settings page
	- Remove variable_get() to email addresses
	- Add a box on the settings page that defaults to the site-wide email
	- Write reg_data::get_contact_email()

- Onsite reg
	- Public page to take member info, but not billing info or payment details
	- New button on member details page: "Print Badge"
	- New security level: "reg staff"
	- Staff pages:
		- Search memberships
		- View Memberships
			- Display log entries
		- Edit Membership
			- Add note
			- Balance adjustment
		- Print badge
	- Badge printing system:
		- Page to list pending badges to be printed
			- Table to hold pending badges: reg_id, printer ("default", "minor", etc.), status ("new", "printing", "printed")
			- Link to membership info and badge name
			- Link to cancel print job
		- Page to print badges
			- Javascript:
				- Start up Word, load badge template
				- Query for print jobs via ajax.php file
					- Can I place a menu item that is only called via AJAX?
						- See http://drupal.org/node/42562
					- reg_ajax class?
					- Otherwise, I have to check in reg_init().  Ugh
				- Send badge data to Word, tell Word to print
				- Block on Word, then call ajax.php to log success
				- Wait n seconds, loop
				- On screen elements can be updated

- Keep in mind that I can create other modules in that directory
	- Dealer reg module?
	- Staff reg module
	- Onsite reg module?
		- Here's some ActiveXCode to print things up from MSIE:
			var app = new ActiveXObject("word.application");

			// This could/should be replaced with a web-based path?
			var file = "file:///C:/wamp/www/template.doc";

			app.Visible = false;
			app.Documents.Open(file);
			// var doc = app.Documents.Open(file); ??

			//bookmark_replace() function?
			//doc.BookMarks("AEName").range.InsertBefore("<%=AEName%>");  ???
			//doc.BookMarks("AEName").range.Text = "foobar"; ???

			app.ActiveDocument.PrintOut();
			app.ActiveDocument.close(false);

			app.quit();

- Admin
	- Resend confirmation email

- Class architecture
	- Function to send confirmation email for a specific registration
		- Store this confirmation email as a variable?

Long Term
=========

- Can we have an upgrade type?
	- Upgrade table that has a membership type, upgrade options, price, description, etc.

- Export data as a spreadsheet
	- Main membership data
	- Staff data separately?

- Do distance calculations
	- http://jan.ucc.nau.edu/~cvm/latlon_formula.html

- Watchlist
	- Pre-sanitize data into new fields at insert time?

